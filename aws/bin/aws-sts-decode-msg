#!/usr/bin/env bash

# AWS STS Decode Message
# ======================
# Tim Friske <me@tifr.de>
#
# Decodes the given Base64-encoded message.
#
# Deps:: aws, bash, env, jq

# Ensure fail-fast script execution.
shopt -os nounset pipefail errexit errtrace

# Input parameters and validation:
ENCODED_MESSAGE="${1:-"${ENCODED_MESSAGE:?required}"}"

aws sts decode-authorization-message --encoded-message "${ENCODED_MESSAGE}" \
| jq '. + {DecodedMessage:.DecodedMessage|fromjson}'
